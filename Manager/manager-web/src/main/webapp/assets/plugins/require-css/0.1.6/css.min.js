/*
 * Require-CSS RequireJS css! loader plugin
 * 0.1.8
 * Guy Bedford 2014
 * MIT
 */

define(function() {
	
	if (typeof window == 'undefined')
		return {
			load : function(n, r, load) {
				load()
			}
		};

	var head = document.getElementsByTagName('head')[0];

	var cssAPI = {};

	cssAPI.pluginBuilder = './css-builder';

	var linkLoad = function(cssId, url, callback) {
		var link = document.createElement('link');
		link.type = 'text/css';
		link.rel = 'stylesheet';

		link.setAttribute("data-requirecssmodule", cssId);
		
		link.onload = function() {
			link.onload = function() {
			};
			setTimeout(callback, 7);
		}
		link.href = url;
		head.appendChild(link);
	}

	cssAPI.normalize = function(name, normalize) {
		if (name.substr(name.length - 4, 4) == '.css')
			name = name.substr(0, name.length - 4);

		return normalize(name);
	}

	cssAPI.load = function(cssId, req, load, config) {
		if (!require.undefCss) {
			require.undefCss = function(name) {
				var linkAry = document.getElementsByTagName('link');
				if (linkAry) {
					for (var i = 0, tmpSize = linkAry.length; i < tmpSize; i++) {
						if (linkAry[i].getAttribute('data-requirecssmodule') === name) {
							linkAry[i].parentNode.removeChild(linkAry[i]);
							require.undef('css!'+name);
						}
					}
				}
			};
		}

		linkLoad(cssId, req.toUrl(cssId + '.css'), load);
	}

	return cssAPI;
});